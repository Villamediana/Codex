<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projetos</title>

  <!-- Limpa caches do navegador -->
  <!-- Assets externos -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css" />

</head>

<body>

  <!-- Backdrop -->
  <div id="backdrop" class="backdrop" onclick="toggleSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">×</button>

    <h5 style="padding:1rem 1.25rem 0;">Filtros</h5>
    <hr />
    <div style="padding:0 1.25rem 1rem;">
      <input id="search-input" placeholder="Buscar projeto..."
        style="width:100%;padding:.5rem;border:1px solid var(--border);border-radius:6px;">
    </div>

    <div class="filters" style="padding:0 1.25rem 1.5rem;">
      <h6>Disciplina</h6>
      {% for disc in disciplines %}
      <div class="form-check">
        <input type="checkbox" id="filter-{{ disc|lower|replace(' ', '-') }}" value="{{ disc }}" checked>
        <label for="filter-{{ disc|lower|replace(' ', '-') }}">{{ disc }}</label>
      </div>
      {% endfor %}
    </div>

    <!-- Navegação extra (mobile) -->
    <nav class="mobile-nav">
      <a href="{{ url_for('index') }}" class="active">Projetos</a>
      <a href="{{ url_for('pilares_view') }}">Pensamento Computacional</a>
      <a href="{{ url_for('microbit_view') }}">Sobre micro:bit</a>
      <a href="{{ url_for('habilidades_view') }}">Habilidades</a>
      <a href="{{ url_for('create') }}">Novo</a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfqf776C8mtneSYdsFmEV6RDLfmqXuI-46qhDPs3jMf7vACwg/viewform?usp=header"
        target="_blank">Formulário</a>
    </nav>
  </aside>

  <!-- Área principal -->
  <div class="content-area">

    <!-- Navegação superior -->
    <nav class="top-nav">
      <button class="menu-toggle" onclick="toggleSidebar()">☰</button>

      <div class="nav-links">
        <a href="{{ url_for('index') }}" class="active">Projetos</a>
        <a href="{{ url_for('pilares_view') }}">Pensamento Computacional</a>
        <a href="{{ url_for('microbit_view') }}">Sobre micro:bit</a>
        <a href="{{ url_for('habilidades_view') }}">Habilidades</a>
        <a href="{{ url_for('create') }}">Novo</a>
      </div>

      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfqf776C8mtneSYdsFmEV6RDLfmqXuI-46qhDPs3jMf7vACwg/viewform?usp=header"
        target="_blank" class="btn-accent btn-formulario">Formulário</a>
    </nav>

    <section class="main-content">
      <h2>Lista de Projetos</h2>

      <div id="cards-container" class="card-grid">
        {% for p in projects %}
        <div class="card" data-discipline="{{ p.discipline }}" data-name="{{ p.name | lower }}">
          <form method="POST" action="{{ url_for('delete_project', project_id=p.id) }}"
            onsubmit="return confirm('Deseja excluir o projeto {{ p.name }}?');">
            <button type="submit" class="delete-btn" title="Excluir">×</button>
          </form>

          <a href="{{ url_for('edit_project', project_id=p.id) }}" class="edit-btn" title="Editar">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
              <path
                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
                fill="#555" />
            </svg>
          </a>

          <img src="{{ url_for('static', filename=p.image) }}" alt="Imagem de {{ p.name }}">

          <div class="card-body">
            <h5 class="card-title">{{ p.name }}</h5>
            <p><span class="discipline-label">{{ p.discipline }}</span></p>
            <a href="{{ url_for('project_detail', project_id=p.id) }}" class="stretched-link"></a>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    function toggleSidebar() {
      const sb = document.getElementById('sidebar');
      const bd = document.getElementById('backdrop');
      sb.classList.toggle('open');
      bd.style.display = sb.classList.contains('open') ? 'block' : 'none';
    }
  </script>

  <!-- Liberação / ocultação de botões -->
  <script>
    const btns = (sel, val) => document.querySelectorAll(sel).forEach(b => b.style.display = val);
    const TTL = 24 * 60 * 60 * 1000;

    function liberacaoValida() {
      const ts = localStorage.getItem('liberado_ate');
      return ts && Date.now() < +ts;
    }
    function ocultarBotoes() { btns('.edit-btn, .delete-btn', 'none'); }
    function mostrarBotoes() { btns('.edit-btn, .delete-btn', ''); }

    window.addEventListener('DOMContentLoaded', () => {
      liberacaoValida() ? mostrarBotoes() : ocultarBotoes();
    });
    window.liberar = () => { localStorage.setItem('liberado_ate', Date.now() + TTL); mostrarBotoes(); };
    window.ocultar = () => { localStorage.removeItem('liberado_ate'); ocultarBotoes(); };
  </script>

</body>

</html>